// ==UserScript==
// @name        WordPress Moderator Shortcuts
// @include     http*://wordpress.org/support/bb-admin/posts.php*
// @include     http*://wordpress.org/support/profile/*/edit*
// @description adds shortcut navigation for WordPress moderators
// @version     1
// @grant       none
// ==/UserScript==

function with_jquery(f) {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.textContent = "(" + f.toString() + ")(jQuery)";
    document.body.appendChild(script);
};

with_jquery(function($) {

var WordPress_moderator_bookmarklet=function(){var c="hide";var m="#d5e8d2";var y="#bookmark_menu{position:fixed;top:10px;left:65px;background:white;border:3px solid;padding:10px}#bookmark_menu a{text-decoration:none}#wordpress-org #bookmark_menu{font-size:13px}#wordpress-org #bookmark_menu span#close_menu span{display:none}.shortcut{background-color:#cae8f7;padding:1px 3px;display:inline-block;margin-bottom:4px;font-weight:bold}#shortcut_title{display:block;font-weight:bold;margin:1em 0}#wordpress-org #shortcut_title{display:inline}#shortcut_top{margin-bottom:1em}#close_menu{padding:0;margin:4px;1em 0 0}#close_menu a{float:right;vertical-align:bottom;font-size:1.4em;border:0}#extra_info_text{margin-right:40px}.edit_profile_link{display:block;margin-top:5px}",g='<span id="shortcut_title">Shortcuts available on this page:</span>',D=$('<span id="shortcuts">(h) </span><a href="#">shortcuts</a>'),s='<span class="shortcut">m</span> - show/hide menu<br/><span class="shortcut">t</span> - go to the top of this page  | <span class="shortcut">b</span> - go to the bottom of this page<br/>',B=$('<span id="close_menu"><a href="#" >&#10006;</a></span>'),G=$('<div id="bookmark_menu"></div>'),I,x,r,o,F=false,i=false,A={},p,E,l,k,b,w,j,q,f,u,z,e=false,H=$('<span id="extra_info_text"></span>');function t(){if($("#bookmark_menu").length>0){return}var J="table.widefat tr.current_post td{border:solid #9f9f9f;border-width:2px 0}table.widefat tr.current_post td.check-column{border-left:2px solid #9f9f9f}table.widefat tr.current_post td.date{border-right:2px solid #9f9f9f}.normal_span,.bozo_span{display:block;margin-top:10px;color:white;text-align:center;background:red}.normal_span{background:green}.profile_type{padding:4px 6px;border:1px solid red}.profile_type.green{border:1px solid green}",K='<span class="shortcut">h</span> - show/hide shortcuts<br/><span class="shortcut">d</span> - loop through Bulk Actions dropdown options<br/><span class="shortcut">a</span> - select/deselect all posts<br/><span class="shortcut">s</span> - select/deselect current post<br/><span class="shortcut">i</span> - open all <span style="background:'+m+';">selected posts</span> edit profile pages in new tabs. (depending on your browser setting)<br/><span class="shortcut">n</span> - go to the next post | <span class="shortcut">p</span> - go to the previous post<br/><span class="shortcut">z</span> - go to the next normal profile post | <span class="shortcut">x</span> - go to the previous normal profile post<br/><span class="shortcut">shift z</span> - go to the next bozo profile post | <span class="shortcut">shift x</span> - go to the previous bozo profile post<br/><span class="shortcut">mouse click</span> - Click in the "Author" column to select/deselect a post (also sets the post to current)<br/><span class="shortcut">mouse click</span> - Click anywhere in a post to set it to current, for navigation with the shortcuts <span class="shortcut">n</span> and <span class="shortcut">p</span> (see above)',d=$("#bbUserInfo > p").html();$("head").append('<style type="text/css">'+y+J+"</style>");j='<p id="shortcut_list" style="display: none;">'+g+s+K+"</p>";G.append(D,B,j);$("body").append(G);$("#bbUserInfo > p").prepend(H);if(c=="hide"){G.hide();H.text("type m to display menu")}if(c=="show"){H.text("type m to hide menu")}$("#post-search-form").focusin(function(){e=true}).focusout(function(){e=false});F=(($("tr.post-status-2").length>0)||($("tr.deleted").length>0))?true:false;q="current_post";f="tr.current_post";u="tr:first";r=".check-column > input";x=$("thead tr "+r+",tfoot tr "+r);z=$("#posts-list tbody tr");b=$("#bbHead");w=z.last();o=$("td.author");C(D,B);a()}function n(){if($("#bookmark_menu").length>0){return}$("head").append('<style type="text/css">'+y+"</style>");var d='<span class="shortcut">n</span> - go to the next section | <span class="shortcut">p</span> - go to the previous section<br/><span class="shortcut">w</span> - remove or add (back) website url<br/><span class="shortcut">z</span> - select/deselect "This user is a bozo" checkbox<br/><span class="shortcut">x</span> - select/deselect "Akismet Never Trust" checkbox<br/>',J=$('<p id="shortcut_top">'+g+"</p>");J.append(B);j="<p>"+s+d+"</p>";G.append(J,j);$("body").append(G);G.hide();H.text("type m to display menu");$("#profile-form").before('<p id="extra_info"></p>');$("#extra_info").append(H);p=$("#user_url");E=p.val();q="current_section";f="#profile-form h3.current_section";u="h3.section:first";z=$("#profile-form h3");b=$("#header");w=$("#footer");l=$("input#is_bozo");k=$("#elf_not_trusted");z.addClass("section");$("h3:contains('Mailing Lists')").removeClass("section");$("h3:contains('Administration')").addClass("admin_section");$("label[for='user_url']").append(' <span class="shortcut">(w)</span>');$("label[for='is_bozo']").append(' <span class="shortcut">(z)</span>');$("label[for='elf_not_trusted']").append(' <span class="shortcut">(x)</span>');$("#profile-form").focusin(function(){e=true}).focusout(function(){e=false});v();a()}function v(){$("html").bind("keydown.bookmarkprofile",function(K){if(e===false){if(K.keyCode===87){if(p.length==1){$(f).removeClass(q);var J=z.first();J.addClass(q);h(J);if(E){if(p.val()==""){p.val(E)}else{p.val("")}}}}if(K.keyCode===90||K.keyCode===88){var d=(K.keyCode===90)?l:k;if(d){h($("h3.admin_section"));if(d.attr("checked")){d.removeAttr("checked")}else{d.click()}}}}})}function C(d,L){J();$(document).keyup(function(M){delete A[M.which]});$("html").bind("keydown.bookmark",function(R){A[R.which]=true;if(e===false){if(R.keyCode===83){S=$(f);if(S.length==1){h(S);var N=S.find(r);N.attr("checked",!N.attr("checked"));J()}}if(R.keyCode===68){$(".bulk-form select[name=action] > option:selected").removeAttr("selected").next("option").attr("selected","selected")}if(R.keyCode===65){I=($(x).attr("checked"))?"off":"on";K()}if(R.keyCode===72){$("#shortcut_list").toggle()}if(R.keyCode===73){var T=[];$(".post_selected").each(function(){var V=$(this).children().first("a").attr("href");if(T.indexOf(V)==-1){T.push(V);window.open(V+"/edit")}})}if(z.length>=1){if(A.hasOwnProperty(90)||A.hasOwnProperty(88)){var P=(A.hasOwnProperty(16))?"bozo":"normal";if(i!=P){i==P;(P=="bozo")?z.removeClass("current_normal_post"):z.removeClass("current_bozo_post")}var U=A.hasOwnProperty(90)?"z":"x",O=$("."+P+"_post");if(O.length>0){if($(".current_"+P+"_post").length==0){var S=(U=="z")?O.first():O.last();z.removeClass(q);S.addClass("current_"+P+"_post "+q);h(S)}else{if(O.length==1){var Q=O.first();z.removeClass(q);Q.addClass(q);h(Q)}else{var M,S=$(".current_"+P+"_post");if(U=="z"){M=S.nextAll("."+P+"_post:first")}if(U=="x"){M=S.prevAll("."+P+"_post:first")}if(M.length){z.removeClass(q);S.removeClass("current_"+P+"_post");M.addClass("current_"+P+"_post "+q);h(M)}}}}}}}});$(x).bind("click.bookmark",function(){I=($(this).attr("checked"))?"on":"off";K()});z.click(function(M){if(M.target.nodeName!="A"){$("tbody tr").removeClass(q);$(this).addClass(q)}});$("tbody > tr > "+r).bind("click.bookmark",function(M){J()});o.click(function(M){if(M.target.nodeName!="A"){J($(this).parent().attr("id"))}});d.click(function(M){M.preventDefault();$("#shortcut_list").toggle()});function K(){o.each(function(){var M=$(this).parent().find(r);(I=="on")?M.attr("checked",true):M.attr("checked",false)});J();I=false}function J(T){G.children("#detected").remove();var P=0,S=0,O=0,R=0,Q=false;o.each(function(){var Z=$(this).parent().children(".post").css("background-color"),Y=$(this).parent().attr("class"),W=$.trim($(this).children().first("a").text()),X=$(this).parent().find(r);$(this).css("background",Z);if($(this).children(".edit_profile_link").length==0){var V=$("img",$(this).children().first("a")),U='<br/><span class="edit_profile_link"><a href="'+$(this).children().first("a").attr("href")+'/edit">Edit Profile</a></span>';if(W.indexOf("(BOZO)")>=0){W=$.trim(W.replace("(BOZO)",""));$(this).children().first("a").text(" "+W);if(V){$(this).children().first("a").prepend(V)}$(this).append('<span class="bozo_span" >BOZO</span>');$(this).parent().addClass("bozo_post");++S}else{if((Y.indexOf("post-status-2")!=-1)||(Y.indexOf("deleted")!=-1)){$(this).append('<span class="normal_span" >NORMAL</span>')}$(this).parent().addClass("normal_post")}$(this).children().first("a").after(U)}else{if($(this).children("span.bozo_span").length){++S}else{$(this).parent().addClass("normal_post")}}if(X.attr("checked")){$(this).attr("style","background: "+m+";");$(this).addClass("post_selected")}else{$(this).css("background",Z);$(this).removeClass("post_selected")}if((typeof(T)!=="undefined")&&(T==$(this).parent().attr("id"))){if(X.attr("checked")){$(this).css("background",Z);X.attr("checked",false);$(this).removeClass("post_selected")}else{$(this).attr("style","background: "+m+";");X.attr("checked",true);$(this).addClass("post_selected")}}});var N=$("tbody > tr").length,O=$("tbody > tr > "+r+":checked").length;if(O<N){$(x).attr("checked",false)}if(O==N){$(x).attr("checked",true)}var M="";M+="Current Page: "+N+" post"+((N==1)?"":"s");M+=' &#10022; <span class="profile_type">';M+=(S>0)?S+" bozo"+((S==1)?"":"s"):"no bozos";M+="</span>";M+=' &#10022; <span class="profile_type green">';M+=(N-S>0)?(N-S)+" normal profile"+(((N-S)==1)?"":"s"):"no normal profiles";M+="</span>";M+=' | <span style="background-color: '+m+'; padding: 5px 7px;">';M+=(O>0)?O+" post"+((O==1)?"":"s")+" selected":"No posts selected";M+="</span> | ";G.children("#shortcuts").before('<span id="detected" style="padding-bottom: 1em;">'+M+"</span>")}}var h=function(d){var J=d.offset().top-(($("#bookmark_menu").is(":visible"))?60:5);$("html, body").animate({scrollTop:J},{duration:150})};function a(){function d(){z.removeClass("current_post current_normal_post current_bozo_post current_section")}B.click(function(K){K.preventDefault();G.toggle();$("#shortcut_list").hide();var J=(G.is(":visible"))?"hides":"display";H.text("type m to "+J+" menu")});$("html").bind("keydown.bookmark_all",function(M){if(e===false){if(M.keyCode===78||M.keyCode===80){var K=M.keyCode===78?"n":"p";z.removeClass("current_normal_post current_bozo_post");if($(f).length==0){if(K=="n"){var L=z.first();h(L);L.addClass(q)}}else{var L=$(f);if(K=="n"){if(L.nextAll(u).length!=0){L.removeClass(q).nextAll(u).addClass(q);h($(f))}else{h($(f))}}if(K=="p"){if(L.prevAll(u).length!=0){L.removeClass(q).prevAll(u).addClass(q);h($(f))}else{L.removeClass(q);h(b)}}}}if(M.keyCode===77){G.toggle();$("#shortcut_list").hide();var J=(G.is(":visible"))?"hide":"display";H.text("type m to "+J+" menu")}if(M.keyCode===84){if(b.length){h(b);d()}}if(M.keyCode===66){if(w.length){h(w);d();var L=z.last();L.addClass(q)}}}})}return{moderate_spam_posts_init:t,moderate_profile_form_init:n}}();if($("#posts-list").length){WordPress_moderator_bookmarklet.moderate_spam_posts_init()}if($("#profile-form").length){WordPress_moderator_bookmarklet.moderate_profile_form_init()};}); // end with_jquery